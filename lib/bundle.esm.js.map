{"version":3,"file":"bundle.esm.js","sources":["../src/utils/index.ts","../src/core/instance.ts","../src/core/mixin.ts","../src/core/directive.ts","../src/components/rolerView.ts","../src/core/init.ts","../src/core/hook.ts","../src/index.ts"],"sourcesContent":["const typeEnum = {\n    \"string\":\"[object String]\",\n    \"number\":\"[object Number]\",\n    \"boolean\":\"[object Boolean]\",\n    \"undefined\":\"object Undefined]\",\n    \"null\":\"object Null]\",\n    \"object\":\"[object Object]\",\n    \"function\":\"[object Function]\",\n    \"array\":\"[object Array]\",\n    \"date\":\"[object Date]\",\n    \"reg\":\"[object RegExp]\"\n};\n\n\n/**\n * Verify that a value is an object\n * @param {any} obj \n * @returns {boolean}\n * @author  chrislee\n * @Time 2020/7/12\n */\nexport const isObject:(obj:unknown)=>boolean = (obj) =>{\n    let res = true;\n    if(Object.prototype.toString.call(obj) === '[object Object]'){\n        res = true;\n    }else{\n        res = false;\n    }\n    return res;\n};\n\n/**\n * Verify that a value is undefined\n * @param {any} obj\n * @returns {boolean}\n * @author chrislee\n * @Time 2020/7/12\n */\nexport const isUndefined:(obj:unknown)=>boolean = (obj) => {\n    let res: boolean;\n    if(obj === undefined||Object.prototype.toString.call(obj)===typeEnum[\"undefined\"]){\n        res = true;\n    }else{\n        res = false;\n    }\n    return res;\n};\n\n/**\n * Verify that a value is an array\n * @param {any} obj\n * @returns {boolean}\n * @author chrislee\n * @Time 2020/7/12\n */\nexport const isArray:(obj:unknown)=>boolean = (obj) =>{\n    let res:boolean;\n    if(obj instanceof Array || Object.prototype.toString.call(obj)===typeEnum[\"array\"]){\n        res = true;\n    }else{\n        res = false;\n    }\n    return res;\n};\n\n/**\n * Verify that a value is an boolean\n * @param {any} obj\n * @returns {boolean}\n * @author chrislee\n * @Time 2020/7/12\n */\nexport const isBoolean:(obj:unknown) => boolean = (obj) => {\n    let res:boolean;\n    if( Object.prototype.toString.call(obj)===typeEnum[\"boolean\"]){\n        res = true;\n    }else{\n        res = false;\n    }\n    return res;\n};\n\n\nexport const typeValidate:(obj:unknown,type:keyof typeof typeEnum,constant?:string)=>boolean = (obj,type,constant=`The value of target`) =>{\n    let res:boolean;\n    if(Object.prototype.toString.call(obj)=== typeEnum[type]){\n        res = true;\n    }else{\n        let currentType = `undefined`;\n        for(const key in typeEnum){\n            if(typeEnum[key] === Object.prototype.toString.call(obj)){\n                currentType = key;\n            }\n        }\n        throw TypeError(`${constant} expect a ${type},but got ${currentType}`);\n    }\n    return res;\n};","import { RoleInstanceClass } from \"src/types/global\";\nimport {reactive, Ref, ref, watch} from \"vue\";\nimport {isArray,typeValidate} from \"../utils\";\n\nclass RoleInstance implements RoleInstanceClass {\n    private roles= reactive<{extra:string[],constant:string[]}>({\n        extra:[],\n        constant:[]\n    })\n\n    constructor(list:string[]){\n        this.init(list)\n    }\n\n    init(param:string[]){\n        if(isArray(param)){\n            const isString = param.every(v => typeof(v) === \"string\");\n            if(isString===false){\n                throw new Error(`the item in roles array expect type 'String'!`)\n            }else{\n               this.roles.constant = [...param];\n               this.roles.extra = [...param];\n               watch(this.roles.extra,()=>{\n                   console.log(\"roles update\")\n               })\n            }\n        }else{\n            throw new Error(`please use a array as roles init option`)\n        }\n    }\n\n    getRoles():string[]{\n        return this.roles.extra\n    }\n\n    addRole(role:string|string[]):string[]{\n        if(typeof role === \"string\"){\n            this.roles.extra.push(role)\n        }else{\n            // const originRoles = [...this.roles.extra];\n            this.roles.extra = this.roles.extra.concat(role)\n\n        }\n        return this.roles.extra\n    }\n\n    update(param:string[]){\n        const constant = [...this.roles.constant];\n        this.roles.extra = [...constant,...param];\n    }\n\n    match(role:string):boolean {\n        const isString: boolean = typeValidate(role,\"string\",\"the validate target\");\n        if(!isString) return false\n        const result = this.roles.extra.includes(role)\n        return result\n    }\n}\n\n\n/**\n * 单例模式构造类\n * @param roles 角色数组\n * @author chrislee\n * @Time 2020/9/3\n */\nclass RoleCtr implements RoleInstanceClass {\n    private ins:RoleInstanceClass | null = null;\n\n    init(roles:string[]){\n        if(this.ins===null){\n            this.ins = new RoleInstance(roles);\n        }\n    }\n\n    getRoles():string[]{\n        return this.getInstance().getRoles()\n    }\n\n    update(roles:string[]){\n        this.getInstance().update(roles)\n    }\n\n    addRole(role:string|string[]):string[]{\n       return this.getInstance().addRole(role)\n    }\n\n    match(role:string):boolean{\n        return this.getInstance().match(role)\n    }\n\n    getInstance():RoleInstanceClass{\n        if(this.ins!==null){\n            return this.ins\n        }else{\n            throw new Error(`Fail to create the [v-roler] instance, please check the plugin if is installed `)\n        }\n    }\n}\n\nexport default new RoleCtr()","import { App,readonly } from \"vue\";\n\nimport RoleCtr from \"./instance\";\n\nexport const initMixin = (app:App):App => {\n    app.config.globalProperties.$roles = readonly(RoleCtr.getRoles());\n    app.config.globalProperties.$roler = RoleCtr;\n    app.mixin({data(){\n        return {\n            $$roles:RoleCtr.getRoles()\n        }\n    }})\n\n    return app\n}","import { PluginOpt } from \"src/types/global\";\nimport {App, FunctionDirective, watch,} from \"vue\";\nimport RoleCtr from \"./instance\";\n\nexport const fnDirective:FunctionDirective<HTMLElement,string> = (el,binding,vnode) => {\n    const targetByArg:string|undefined = binding.arg;\n    const targetByVal:string = binding.value;\n    const role:string = targetByArg?targetByArg:targetByVal;\n    if(RoleCtr.getRoles().length<=0) return\n    if(RoleCtr.match(role)!==true){\n        el.parentNode?.removeChild(el);  \n    }\n    const rolesRef = RoleCtr.getRoles();\n    binding.instance?.$watch(()=>rolesRef,()=>{\n        binding.instance?.$forceUpdate()\n    })\n    return\n}\n\nexport const initDirective = (app:App,opts:PluginOpt):App => {\n    const command = opts.command??'can';\n    return app.directive(`${command}`,fnDirective)\n}","import { FunctionalComponent,h,defineComponent, toRefs, VNode, isRef } from \"vue\";\nimport RoleCtr from \"../core/instance\";\n\ninterface Props {\n    role:string\n}\n\nexport const rolerView:FunctionalComponent<Props> = (props,{slots}) => {\n    const role = props.role;\n    const isMatch = (role && RoleCtr.match(role))??false;\n    if(isMatch&&slots.default){\n        return slots.default\n    }else{\n        return null\n    }\n}\n","import { App } from \"vue\";\nimport RoleCtr from \"./instance\";\nimport {initMixin} from \"./mixin\";\nimport {initDirective} from \"./directive\";\nimport {rolerView} from \"../components/rolerView\";\nimport { PluginOpt } from \"src/types/global\";\n\n/**\n * 初始化权限路由管理器及其工具\n * @param {App} app 当前vue实例\n * @param {PluginOpt} opts 插件配置项\n * @author chrislee\n * @Time 2020/10/27\n */\nexport default function initVRoler(app:App,opts:PluginOpt):App {\n    RoleCtr.init(opts.roles);\n    initMixin(app);\n    initDirective(app,opts);\n    registerComponent(app);\n    return app\n}\n\n/**\n * 注册全局组件\n * @param app \n * @author chrislee\n * @Time 2020/10/27\n */\nfunction registerComponent(app:App){\n    app.component(\"roler-view\",rolerView)\n}","import {Ref, ref} from \"vue\";\nimport RoleCtr from \"./instance\";\n\ntype roles = string[]\ntype updateRolesFn = (roles:string[])=>void\ntype useRolerResult = [roles,updateRolesFn]\n\nexport function useRoler(roles?:string[]):[roles,updateRolesFn]{\n    let currentRoles:string[]\n    if(roles){\n       currentRoles = RoleCtr.addRole(roles)\n    }else{\n        currentRoles = RoleCtr.getRoles()\n    }\n\n    function update(roles){\n        RoleCtr.update(roles)\n    }\n\n    return [currentRoles,update]\n}","import {App, Plugin} from \"vue\";\nimport init from \"./core/init\";\nimport {useRoler} from \"./core/hook\";\nimport { PluginOpt } from \"./types/global\";\n\nlet Vue:App;\n\n\n/**\n * v-role初始化安装逻辑\n * @param app vue实例\n * @param opts 路由配置项\n * @author chrislee\n * @Time 2020/10/24\n */\nconst vRolerPlugin: Plugin = (app,opts:PluginOpt):void => {\n    if(Vue&&Vue === app){\n        console.error(`[v-roler] already installed. app.use(vRoler) should be called only once in each app`);\n        return\n    }else{\n        Vue = init(app,opts);\n    }\n}\n\nexport default vRolerPlugin\nexport {useRoler}"],"names":["RoleCtr","init"],"mappings":";;AAAA,MAAM,QAAQ,GAAG;IACb,QAAQ,EAAC,iBAAiB;IAC1B,QAAQ,EAAC,iBAAiB;IAC1B,SAAS,EAAC,kBAAkB;IAC5B,WAAW,EAAC,mBAAmB;IAC/B,MAAM,EAAC,cAAc;IACrB,QAAQ,EAAC,iBAAiB;IAC1B,UAAU,EAAC,mBAAmB;IAC9B,OAAO,EAAC,gBAAgB;IACxB,MAAM,EAAC,eAAe;IACtB,KAAK,EAAC,iBAAiB;CAC1B,CAAC;AAqCF;;;;;;;AAOO,MAAM,OAAO,GAA0B,CAAC,GAAG;IAC9C,IAAI,GAAW,CAAC;IAChB,IAAG,GAAG,YAAY,KAAK,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,KAAG,QAAQ,CAAC,OAAO,CAAC,EAAC;QAC/E,GAAG,GAAG,IAAI,CAAC;KACd;SAAI;QACD,GAAG,GAAG,KAAK,CAAC;KACf;IACD,OAAO,GAAG,CAAC;AACf,CAAC,CAAC;AAoBK,MAAM,YAAY,GAAsE,CAAC,GAAG,EAAC,IAAI,EAAC,QAAQ,GAAC,qBAAqB;IACnI,IAAI,GAAW,CAAC;IAChB,IAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,KAAI,QAAQ,CAAC,IAAI,CAAC,EAAC;QACrD,GAAG,GAAG,IAAI,CAAC;KACd;SAAI;QACD,IAAI,WAAW,GAAG,WAAW,CAAC;QAC9B,KAAI,MAAM,GAAG,IAAI,QAAQ,EAAC;YACtB,IAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,EAAC;gBACrD,WAAW,GAAG,GAAG,CAAC;aACrB;SACJ;QACD,MAAM,SAAS,CAAC,GAAG,QAAQ,aAAa,IAAI,YAAY,WAAW,EAAE,CAAC,CAAC;KAC1E;IACD,OAAO,GAAG,CAAC;AACf,CAAC;;AC7FD,MAAM,YAAY;IAMd,YAAY,IAAa;QALjB,UAAK,GAAE,QAAQ,CAAqC;YACxD,KAAK,EAAC,EAAE;YACR,QAAQ,EAAC,EAAE;SACd,CAAC,CAAA;QAGE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;KAClB;IAED,IAAI,CAAC,KAAc;QACf,IAAG,OAAO,CAAC,KAAK,CAAC,EAAC;YACd,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,QAAO,CAAC,CAAC,KAAK,QAAQ,CAAC,CAAC;YAC1D,IAAG,QAAQ,KAAG,KAAK,EAAC;gBAChB,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAA;aACnE;iBAAI;gBACF,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC;gBACjC,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC;gBAC9B,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAC;oBACnB,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAA;iBAC9B,CAAC,CAAA;aACJ;SACJ;aAAI;YACD,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAA;SAC7D;KACJ;IAED,QAAQ;QACJ,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAA;KAC1B;IAED,OAAO,CAAC,IAAoB;QACxB,IAAG,OAAO,IAAI,KAAK,QAAQ,EAAC;YACxB,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;SAC9B;aAAI;;YAED,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;SAEnD;QACD,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAA;KAC1B;IAED,MAAM,CAAC,KAAc;QACjB,MAAM,QAAQ,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC1C,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,GAAG,QAAQ,EAAC,GAAG,KAAK,CAAC,CAAC;KAC7C;IAED,KAAK,CAAC,IAAW;QACb,MAAM,QAAQ,GAAY,YAAY,CAAC,IAAI,EAAC,QAAQ,EAAC,qBAAqB,CAAC,CAAC;QAC5E,IAAG,CAAC,QAAQ;YAAE,OAAO,KAAK,CAAA;QAC1B,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;QAC9C,OAAO,MAAM,CAAA;KAChB;CACJ;AAGD;;;;;;AAMA,MAAM,OAAO;IAAb;QACY,QAAG,GAA4B,IAAI,CAAC;KA+B/C;IA7BG,IAAI,CAAC,KAAc;QACf,IAAG,IAAI,CAAC,GAAG,KAAG,IAAI,EAAC;YACf,IAAI,CAAC,GAAG,GAAG,IAAI,YAAY,CAAC,KAAK,CAAC,CAAC;SACtC;KACJ;IAED,QAAQ;QACJ,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC,QAAQ,EAAE,CAAA;KACvC;IAED,MAAM,CAAC,KAAc;QACjB,IAAI,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;KACnC;IAED,OAAO,CAAC,IAAoB;QACzB,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;KACzC;IAED,KAAK,CAAC,IAAW;QACb,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;KACxC;IAED,WAAW;QACP,IAAG,IAAI,CAAC,GAAG,KAAG,IAAI,EAAC;YACf,OAAO,IAAI,CAAC,GAAG,CAAA;SAClB;aAAI;YACD,MAAM,IAAI,KAAK,CAAC,iFAAiF,CAAC,CAAA;SACrG;KACJ;CACJ;AAED,gBAAe,IAAI,OAAO,EAAE;;AChGrB,MAAM,SAAS,GAAG,CAAC,GAAO;IAC7B,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,GAAG,QAAQ,CAACA,SAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;IAClE,GAAG,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,GAAGA,SAAO,CAAC;IAC7C,GAAG,CAAC,KAAK,CAAC,EAAC,IAAI;YACX,OAAO;gBACH,OAAO,EAACA,SAAO,CAAC,QAAQ,EAAE;aAC7B,CAAA;SACJ,EAAC,CAAC,CAAA;IAEH,OAAO,GAAG,CAAA;AACd,CAAC;;ACVM,MAAM,WAAW,GAAyC,CAAC,EAAE,EAAC,OAAO,EAAC,KAAK;;IAC9E,MAAM,WAAW,GAAoB,OAAO,CAAC,GAAG,CAAC;IACjD,MAAM,WAAW,GAAU,OAAO,CAAC,KAAK,CAAC;IACzC,MAAM,IAAI,GAAU,WAAW,GAAC,WAAW,GAAC,WAAW,CAAC;IACxD,IAAGA,SAAO,CAAC,QAAQ,EAAE,CAAC,MAAM,IAAE,CAAC;QAAE,OAAM;IACvC,IAAGA,SAAO,CAAC,KAAK,CAAC,IAAI,CAAC,KAAG,IAAI,EAAC;QAC1B,MAAA,EAAE,CAAC,UAAU,0CAAE,WAAW,CAAC,EAAE,EAAE;KAClC;IACD,MAAM,QAAQ,GAAGA,SAAO,CAAC,QAAQ,EAAE,CAAC;IACpC,MAAA,OAAO,CAAC,QAAQ,0CAAE,MAAM,CAAC,MAAI,QAAQ,EAAC;;QAClC,MAAA,OAAO,CAAC,QAAQ,0CAAE,YAAY,GAAE;KACnC,EAAC;IACF,OAAM;AACV,CAAC,CAAA;AAEM,MAAM,aAAa,GAAG,CAAC,GAAO,EAAC,IAAc;;IAChD,MAAM,OAAO,SAAG,IAAI,CAAC,OAAO,mCAAE,KAAK,CAAC;IACpC,OAAO,GAAG,CAAC,SAAS,CAAC,GAAG,OAAO,EAAE,EAAC,WAAW,CAAC,CAAA;AAClD,CAAC;;ACfM,MAAM,SAAS,GAA8B,CAAC,KAAK,EAAC,EAAC,KAAK,EAAC;;IAC9D,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;IACxB,MAAM,OAAO,UAAI,IAAI,IAAIA,SAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,mCAAE,KAAK,CAAC;IACrD,IAAG,OAAO,IAAE,KAAK,CAAC,OAAO,EAAC;QACtB,OAAO,KAAK,CAAC,OAAO,CAAA;KACvB;SAAI;QACD,OAAO,IAAI,CAAA;KACd;AACL,CAAC;;ACRD;;;;;;;SAOwB,UAAU,CAAC,GAAO,EAAC,IAAc;IACrDA,SAAO,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACzB,SAAS,CAAC,GAAG,CAAC,CAAC;IACf,aAAa,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC;IACxB,iBAAiB,CAAC,GAAG,CAAC,CAAC;IACvB,OAAO,GAAG,CAAA;AACd,CAAC;AAED;;;;;;AAMA,SAAS,iBAAiB,CAAC,GAAO;IAC9B,GAAG,CAAC,SAAS,CAAC,YAAY,EAAC,SAAS,CAAC,CAAA;AACzC;;SCvBgB,QAAQ,CAAC,KAAe;IACpC,IAAI,YAAqB,CAAA;IACzB,IAAG,KAAK,EAAC;QACN,YAAY,GAAGA,SAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;KACvC;SAAI;QACD,YAAY,GAAGA,SAAO,CAAC,QAAQ,EAAE,CAAA;KACpC;IAED,SAAS,MAAM,CAAC,KAAK;QACjBA,SAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;KACxB;IAED,OAAO,CAAC,YAAY,EAAC,MAAM,CAAC,CAAA;AAChC;;ACfA,IAAI,GAAO,CAAC;AAGZ;;;;;;;MAOM,YAAY,GAAW,CAAC,GAAG,EAAC,IAAc;IAC5C,IAAG,GAAG,IAAE,GAAG,KAAK,GAAG,EAAC;QAChB,OAAO,CAAC,KAAK,CAAC,qFAAqF,CAAC,CAAC;QACrG,OAAM;KACT;SAAI;QACD,GAAG,GAAGC,UAAI,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC;KACxB;AACL;;;;;"}